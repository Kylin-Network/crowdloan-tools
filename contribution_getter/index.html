<html>
    <body>
        <div style="margin: 10px;" id="contributions">
            <span id="total-contribution">...</span> (<span id="total-contributors"></span>)
        </div>
        <div style="margin: 10px;" id="calculator">
            <form onsubmit="computeReward(); return false;">
                <input type="float" id="user-contribution" value="1">
                <input type="submit" value="Submit">
            </form>
            <span id="reward">...</span>
        </div>
    </body>
    <script lang="javascript">
        function computeReward() {
            const totalContribution = parseFloat(document.getElementById('total-contribution').innerText);
            const userContribution = parseFloat(document.getElementById('user-contribution').value);

            if (userContribution == NaN) {
                document.getElementById('reward').innerText = "...";
                return;
            }

            document.getElementById('reward').innerText = (userContribution / totalContribution * 3000000).toFixed(4);
        }

        async function loadTotalContribution () {
            console.log("Fecting");
            await fetch("./2023.json")
                .then(response => response.json())
                .then(json => {
                    // 4 digits higher
                    const units = parseFloat(BigInt(json.total_raised) / 100000000n) / 10000;
                    document.getElementById('total-contribution').innerText = units.toFixed(4);
                    document.getElementById('total-contributors').innerText = json.total_contributors;
                    computeReward();
                })
                .catch((err) => {
                    console.log("Fecting failed:", err);
                });
            
            setTimeout(loadTotalContribution, 6000);
            
        }

        window.onload = loadTotalContribution();
    </script>
</html>